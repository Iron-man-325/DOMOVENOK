{% extends 'base/base.html' %}
{% load static %}

{% block css %}
<link href="{% static 'css/show_flat.css' %}" rel="stylesheet">
{% endblock %}
{% block header %}
<header>
        <div class="head">
            <div class="name">
                <div></div>
                <div class="name-only">
                    <h3>Домовенок ЙОУУУУ</h3>
                </div>
            </div>
            <div class="head">
                <input class="search" placeholder="Поиск">
                <div class="navigation-text">
                    <p class="head-navigation-text" onclick="location.href='{% url 'profile' %}'">Главная</p>
                </div>
                <div class="navigation-text">
                    <p class="head-navigation-text" onclick="location.href='{% url 'stat' %}'">Статистика</p>
                </div>
                <div class="navigation-text">
                    <p class="head-navigation-text">Чаты</p>
                </div>
                <div class="navigation-text">
                    <p class="head-navigation-text" onclick="location.href='{% url 'stat' %}'">Квитанции</p>
                </div>
                <div class="navigation-text">
                    <p class="head-navigation-text" onclick="location.href='{% url 'sup' %}'">Поддержка</p>
                </div>
                <div class="navigation-text">
                    <p class="head-navigation-text" onclick="location.href='{% url 'redac' %}'">Настройки</p>
                </div>
                <div>
                    <button class="publish-adv" onclick="location.href='{% url 'add' %}'">
                        <p class="button-text" >Разместить объявление</p>
                    </button>
                </div>
                <div class="logo-small">

                </div>
            </div>
        </div>
    </header>
{% endblock %}
{% block content %}
<div class="content">
    <!-- Блок с картинками (добавьте реализацию) -->
    <div class="image-block">
        <img src="{{ apartment.image.url }}" class="main-image" id="mainImage" alt="Фото квартиры">
    </div>

    <!-- Блок с ценой -->
    <div class="price-block">
        <h3 class="price-text">{{ apartment.cost_per_night }} ₽/ночь</h3>
        <p class="text">{{ apartment.sleeping_places }} спальных мест</p>
    </div>

    <!-- Описание -->
    <div class="description-block">
        <p class="text">{{ apartment.description }}</p>
    </div>

    <!-- Основные характеристики -->
    <div class="characteristics">
        <h3>О квартире</h3>
        <div class="line"></div>
        <div class="content">
            {% if user.is_authenticated and user == apartment.user %}
            <div class="status-block">
                <h3>Управление статусом</h3>
                <form method="post" action="{% url 'update_apartment_status' apartment.id %}">
                    {% csrf_token %}
                    <select name="status" class="status-select">
                        <option value="available" {% if apartment.status == 'available' %}selected{% endif %}>
                            Свободно
                        </option>
                        <option value="rented" {% if apartment.status == 'rented' %}selected{% endif %}>
                            Сдается
                        </option>
                    </select>
                    <button type="submit" class="status-update-btn">Обновить статус</button>
                </form>
            </div>
            {% endif %}

            <div class="status-indicator {% if apartment.status == 'available' %}status-available{% else %}status-rented{% endif %}">
                Статус: {{ apartment.get_status_display }}
            </div>
        </div>
        <!-- Колонки с данными -->
        <div class="columns">
            <div class="part">
                <p class="head-text">Спальные места</p>
                <p class="text">{{ apartment.sleeping_places }} кроватей</p>
            </div>
            <div class="part">
                <p class="head-text">Ванные комнаты</p>
                <p class="text">{{ apartment.bathrooms }}</p>
            </div>
        </div>
        <div class="columns">
            <div class="part">
                <p class="head-text">Владелец</p>
                <p class="text">{{ apartment.user }} </p>
            </div>
            <div class="part">
                <p class="head-text">Статус</p>
                <p class="text">{{ apartment.status }}</p>
            </div>
        </div>
        <div class="line"></div>

        <div class="columns">
            <div class="part">
                <p class="head-text">Минимальный срок аренды</p>
                <p class="text">{{ apartment.min_nights }} ночей</p>
            </div>
            <div class="part">
                <p class="head-text">Предоплата</p>
                <p class="text">{{ apartment.prepayment }}%</p>
            </div>
        </div>

        <div class="line"></div>

        <div class="columns">
            <div class="part">
                <p class="head-text">Расположение</p>
                <p class="text"> Город {{ apartment.city }}, Улица {{ apartment.street }}, Дом {{apartment.housenum }}, Этаж{{apartment.stage}} Квартира{{ apartment.number }}</p>
            </div>
            <div class="part">
                <p class="head-text">Доступность</p>
                <p class="text">{{ apartment.free_at }}</p>
            </div>
        </div>

    </div>

    <!-- Что находится рядом-->
    <div class="amenities-block">
        <h3>Рядом со зданием</h3>
        <div class="line"></div>
        <ul class="amenities-list">
            {{ apartment.nearby_objects }}
        </ul>
    </div>
    <!-- Дополнительные удобства -->
    <div class="amenities-block">
        <h3>Удобства</h3>
        <div class="line"></div>
        <ul class="amenities-list">
            {{ apartment.amenities }}
        </ul>
    </div>

    <!-- Правила проживания -->
    <div class="rules-block">
        <h3>Правила</h3>
        <div class="line"></div>
        <ul class="rules-list">
            {{ apartment.living_rules }}
        </ul>
    </div>
    {% if apartment.status != 'rented' %}
        <div class="rent-form">
            <input 
                type="number" 
                id="days-input" 
                class="days-input" 
                placeholder="Количество дней" 
                min="1"
                value="1"
            >
            <button 
                onclick="redirectToRent()" 
                class="button-submit height-margin"
            >
                <p class="text-submit">Связаться с арендодателем</p>
            </button>
        </div>

        <script>
            function redirectToRent() {
                const days = document.getElementById('days-input').value;
                if (days && days > 0) {
                    window.location.href = `/rent/${ {{ apartment.id }} }/${days}/`;
                } else {
                    alert('Пожалуйста, введите корректное количество дней');
                }
            }
        </script>
    {% endif %}
</div>
{% endblock %}